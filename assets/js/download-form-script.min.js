$("#downloadForm").validator().on("submit", function (event) {
    if (event.isDefaultPrevented()) {
        // handle the invalid form...
        formError();
        submitMSG(false, "Debe completar la información requerida...");
    } else {
        // everything looks good!
        event.preventDefault();
        // submitForm();
        sendEmail(); //SMTPJS Functionality

    }
});



function sendEmail() {
    // Initiate Variables With Form Content
    var name = $("#name").val();
    var email = $("#email").val();
    var cargo = $("#cargo").val();
    var empresa = $("#empresa").val();
    var ae = $('#ae')[0].checked;
    var rm = $('#rm')[0].checked;
    var cs = $('#cs')[0].checked;
    var is = $('#is')[0].checked;
    var ti = $('#ti')[0].checked;
    var ed = $('#ed')[0].checked;
    var ac = $('#ac')[0].checked;
    var cn = $('#cn')[0].checked;
    var td = $('#td')[0].checked;
    var cr = $('#cr')[0].checked;
    var tn = $('#tn')[0].checked;
    var gp = $('#gp')[0].checked;
    var grc = $('#grc')[0].checked;
    var subscribe = $('#subscribe')[0].checked;
    var date = new Date();
    date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
    var msg_body = "<html><h2>Nueva Descarga realizada</h2><br>" +
        "Este mensaje ha sido generado desde el formulario de descarga del portal orbisnetwork.com.ve:<br><br>" +
        "<strong>Fecha:  " + date + ". </strong><br>" + 
        "<strong>Nombre:  </strong>" + name + " <br>" +
        "<strong>E-Mail:  </strong>" + email + " <br>" +
        "<strong>Cargo:   </strong>" + cargo + " <br>" +
        "<strong>Empresa: </strong>" + empresa + " <br><br>" +
        "<h3>Estas son mis áreas de interés:</h3<br>" +
        "<strong>Arquitectura Empresarial:  </strong>" + ae + " <br>" +
        "<strong>Gestión de Riesgos:        </strong>" + rm + " <br>" +
        "<strong>Ciberseguridad:            </strong>" + cs + " <br>" +
        "<strong>Seguridad:                 </strong>" + is + " <br>" +
        "<strong>Gobierno y Gestión de TI:  </strong>" + ti + " <br>" +
        "<strong>Estrategia y Desempeño:    </strong>" + ed + " <br>" +
        "<strong>Auditoría y Cumplimiento:  </strong>" + ac + " <br>" +
        "<strong>Continuidad del Negocio:   </strong>" + cn + " <br>" +
        "<strong>Transformación Digital:    </strong>" + td + " <br>" +
        "<strong>Ciber-Resiliencia:         </strong>" + cr + " <br>" +
        "<strong>Optimización del Negocio:  </strong>" + tn + " <br>" +
        "<strong>Gestión de Procesos:       </strong>" + gp + " <br>" +
        "<strong>GRC:                       </strong>" + grc + " <br><br>" +
        "<strong>Suscribeme:  </strong>" + subscribe + " <br><br><br>" +
        
        "<small>Disclaimer:<br>The information sent with this e-mail message is only for the strict use of the intended recipient. In the event that this e-mail message is incomplete in any way, the recipient is kindly requested to contact the sender of this message. It is not permitted to publish, copy, circulate and/or disclose any of this information to third parties without the permission of Orbis Network. If you are not the intended recipient of and are in possession of this e-mail message, please notify us immediately, delete the e-mail message from your inbox, and do not use it for any purpose or disclose the contents of this message to third parties, or publish, copy or store this information on an information carrier.</small></html>"

    Email.send({
        SecureToken: "d19fa0b4-4fa6-45c2-905e-8cda58ad4e82",
        To: 'contact@orbisnetwork.com.ve',
        From: "contact@orbisnetwork.com.ve",
        Subject: "Nueva Descarga Realizada - Portal Orbis Network.com.ve",
        Body: msg_body,
    })
        .then( message => compose_response_message(message)
           // message => alert(message)
        );

}

function compose_response_message (message) {
    if (message == "OK") {
        formSuccess();
    } else {
        formError();
        submitMSG(false, message);
    }
}



function formSuccess(){
    $("#downloadForm")[0].reset();
    submitMSG(true, "Descargando...");
    document.getElementById('click_me').click();
}

function formError(){
    $("#downloadForm").removeClass().addClass('shake animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
        $(this).removeClass();
    });
}

function submitMSG(valid, msg){
    if(valid){
        var msgClasses = "h2 text-center tada animated text-success";
    } else {
        var msgClasses = "h2 text-center text-danger";
    };
    $("#msgSubmit").removeClass().addClass(msgClasses).text(msg);
}